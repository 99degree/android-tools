Subject: fake Android init properties via env vars
Author: Lo√Øc Minier <loic.minier@ubuntu.com>

--- /dev/null
+++ b/core/adb/env-props.c
@@ -0,0 +1,29 @@
+#include <cutils/properties.h>
+#include <string.h>
+#include <stdlib.h>
+
+#define ENV_PROPS_PREFIX "APROP_"
+
+#define ENV_PROPS_KEY_MAX (PROPERTY_KEY_MAX + sizeof ENV_PROPS_PREFIX)
+
+int property_get(const char *key, char *value, const char *default_value) {
+    char name[ENV_PROPS_KEY_MAX] = ENV_PROPS_PREFIX;
+    char *env;
+
+    strcpy(name + sizeof ENV_PROPS_PREFIX, key);
+
+    env = getenv(name);
+    if (env) {
+        strcpy(value, env);
+    } else {
+        strcpy(value, default_value);
+    }
+    return strlen(value);
+}
+
+int property_set(const char *key, const char *value) {
+    char name[ENV_PROPS_KEY_MAX] = ENV_PROPS_PREFIX;
+
+    strcpy(name + sizeof ENV_PROPS_PREFIX, key);
+    return setenv(name, value, 1);
+}
